webpackJsonp([4],{33:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(){var e=600;return new Promise(function(t,n){function o(){clearTimeout(c),a.onerror=a.onreadystatechange=a.onload=null}function r(){o(),(!a.onreadystatechange||a.readyState&&"complete"===a.readyState)&&t(window.ymaps)}if(window.hasOwnProperty("ymaps"))return setTimeout(function(){return t(window.ymaps)},e),!0;var i=document.getElementsByTagName("head")[0],a=document.createElement("script"),c=void 0;a.onerror=function(){o(),i.removeChild(a),a=null,n(new Error("network"))},a.onreadystatechange?a.onreadystatechange=r:a.onload=r,c=setTimeout(a.onerror,31e3),a.setAttribute("src","https://api-maps.yandex.ru/2.1/?lang=ru-RU"),a.setAttribute("type","text/javascript"),a.setAttribute("charset","utf-8"),a.setAttribute("async","async"),setTimeout(function(){return i.appendChild(a)},e)})}var i=n(2),a=n(58),c=o(a),s=n(7),u=o(s);e.exports=function(e){var t=new c["default"]({collection:u["default"],el:e});return r().then(function(e){return t.renderMap(e)})["catch"](function(){return(0,i.myAlert)("Ошибка интернет соединения!")}),t.render(),t}},58:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(59),u=o(s),l=n(4),f=o(l),h=function(e){function t(){return r(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),c(t,[{key:"initialize",value:function(){this.$map=this.$("#map-map"),this.$code=this.$("#server-id"),this.collection.fetch({reset:!0}),this.$(".toolbar-location").addClass("is-active")}},{key:"render",value:function(){return this._renderInfo()}},{key:"renderMap",value:function(e){var t=this;return e?(e.ready(function(e){var n=new u["default"]({el:t.$map,collection:t.collection});n.render(e)}),this):this}},{key:"_renderInfo",value:function(){var e=f["default"].get("serverID");return this.$code.text(e),this}}]),t}(Backbone.View);t["default"]=h},59:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=n(2),s={timeout:3e4,enableHighAccuracy:!0,maximumAge:0},u=Backbone,l=u.$,f=!1,h=function(e){function t(){return o(this,t),r(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),a(t,[{key:"initialize",value:function(){var e=l("#watch-me");e.click(function(t){t.preventDefault(),f=!f,e[f?"addClass":"removeClass"]("svg-yellow")}),e[f?"addClass":"removeClass"]("svg-yellow"),this.map=null,this.placemark=null,this.watchID=null}},{key:"render",value:function(e){if(!e)return this;var t="img/tiles",n=new e.Layer(t+"/%z/tile-%x-%y.png",{tileTransparent:!0}),o={center:[60.9708073341092,69.065791475563],zoom:18,controls:["zoomControl"],type:"yandex#map"},r={maxZoom:18,minZoom:16},i=new e.Map(this.el,o,r);i.layers.add(n),i.copyrights.add("&copy; ugraweb.ru"),this.map=i,this.ymaps=e,this._drawPolygons()._setPosition()}},{key:"_drawPolygons",value:function(){return this.collection.length&&this.collection.each(this._drawPolygon,this),this}},{key:"_drawPolygon",value:function(e){var t=e.get("polygon");if(t.length){var n=this.ymaps,o=new n.Polygon([t],{},{fillOpacity:0,fillColor:"#ff0000",strokeWidth:0});o.events.add("click",function(){(0,c.confirm)({title:"Информация",message:e.get("name")+". Перейти к расписанию?",buttons:["Нет","Да"],callback:function(t){(t>1||t===!0)&&l(document).trigger("page:load",e.get("id"))}})}),this.map.geoObjects.add(o)}}},{key:"_setPosition",value:function(){return this.watchID=navigator.geolocation.getCurrentPosition(this._geolocationSuccess.bind(this),this._geolocationError.bind(this),s),this}},{key:"_geolocationSuccess",value:function(e){var t=this.map,n=[e.coords.latitude,e.coords.longitude],o=new this.ymaps.Placemark(n,{},{preset:"islands#geolocationIcon"});t.geoObjects.add(o),this.placemark=o,this.watchID=navigator.geolocation.watchPosition(this._geolocationUpdate.bind(this),this._geolocationError.bind(this),s)}},{key:"_geolocationUpdate",value:function(e){if(!this.placemark)return this;var t=[e.coords.latitude,e.coords.longitude];this.placemark.geometry.setCoordinates(t),f&&this.map.setCenter(t)}},{key:"_geolocationError",value:function(e){return console.log("\ncode: "+e.code+" \nmessage: "+e.message),this.watchID&&navigator.geolocation.clearWatch(this.watchID),this}}]),t}(Backbone.View);t["default"]=h}});